async function sendRequest(options: ApiRequestOptions, url: string): Promise<Response> {
    const request: RequestInit = await sendRequestOptions(options);

    try {
        return await fetch(url, request);
    } catch(e) {
        throw createError('failed to fetch: ' + e, options);
    }
}

export async function sendRequestOptions(options: ApiRequestOptions): Promise<RequestInit> {
    const request: RequestInit = {
        method: options.method,
        headers: await getHeaders(options),
        body: getRequestBody(options),
    };
    if (options.withCredentials) {
        request.credentials = 'include';
    }

    return request;
}
